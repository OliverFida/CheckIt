{"ast":null,"code":"import _regeneratorRuntime from\"/home/oliver/Desktop/awl-raumreservierung/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/oliver/Desktop/awl-raumreservierung/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/home/oliver/Desktop/awl-raumreservierung/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/oliver/Desktop/awl-raumreservierung/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";// Component imports\nimport React,{useState,useEffect,useContext}from'react';import{Modal,Button,Form}from'react-bootstrap';import{HomePageContext}from'../../contexts/HomePageContext';import moment from'moment';// Style imports\nimport'../../css/components/UserPage.css';// API imports\nimport timesMap from'../../api/timesMap.json';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var BookingsAPI=require('../../api/bookings');export default function BookingModal(){var _useContext=useContext(HomePageContext),hpContext=_useContext.hpContext,setHpContext=_useContext.setHpContext;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];useEffect(function(){if(hpContext.bookings.selected!==null){setState(hpContext.bookings.selected);}else{setState(null);}},[hpContext.bookings.selected]);useEffect(function(){if(state===null)return;if(state.booking===null){setState(_objectSpread(_objectSpread({},state),{},{booking:{}}));}else{// TODO: Edit/View Mode\n}},[state]);var onCancel=function onCancel(){setHpContext(_objectSpread(_objectSpread({},hpContext),{},{bookings:_objectSpread(_objectSpread({},hpContext.bookings),{},{selected:null})}));};var onDelete=function onDelete(){function doAsync(){return _doAsync.apply(this,arguments);}function _doAsync(){_doAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return BookingsAPI.del(state.booking.id);case 2:_context.next=4;return setHpContext(_objectSpread(_objectSpread({},hpContext),{},{bookings:_objectSpread(_objectSpread({},hpContext.bookings),{},{selected:null,reload:true})}));case 4:case\"end\":return _context.stop();}}},_callee);}));return _doAsync.apply(this,arguments);}doAsync();};var onSubmit=function onSubmit(){function doAsync(){return _doAsync2.apply(this,arguments);}function _doAsync2(){_doAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var targetDateStart,lesson,lessonHourStart,lessonMinuteStart,targetDateEnd;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(state.editMode){_context2.next=15;break;}targetDateStart=moment().weekday(1).add(hpContext.weekSelection.offset,'weeks').add(state.day-1,'days');lesson=timesMap.find(function(target){return target.key===state.lesson;});lessonHourStart=lesson.start.substring(0,2);lessonMinuteStart=lesson.start.substring(3,5);targetDateStart.set('hour',lessonHourStart);targetDateStart.set('minute',lessonMinuteStart);targetDateStart.set('second',0).set('millisecond',0);targetDateEnd=moment(targetDateStart).add(50,'minutes');_context2.next=11;return BookingsAPI.book(hpContext.roomSelection.id,targetDateStart.toJSON(),targetDateEnd.toJSON(),state.booking.note);case 11:_context2.next=13;return setHpContext(_objectSpread(_objectSpread({},hpContext),{},{bookings:_objectSpread(_objectSpread({},hpContext.bookings),{},{selected:null,reload:true})}));case 13:_context2.next=17;break;case 15:_context2.next=17;return setHpContext(_objectSpread(_objectSpread({},hpContext),{},{bookings:_objectSpread(_objectSpread({},hpContext.bookings),{},{selected:null,reload:true})}));case 17:case\"end\":return _context2.stop();}}},_callee2);}));return _doAsync2.apply(this,arguments);}doAsync();};return/*#__PURE__*/_jsxs(Modal,{show:state!==null,onHide:onCancel,centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Buchung\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(HoursPicker,{state:state,setState:setState}),/*#__PURE__*/_jsx(NoteField,{state:state,setState:setState})]})}),!(state!==null&&state!==void 0&&state.viewMode)?/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"ghost\",onClick:onCancel,children:\"Abbrechen\"}),state!==null&&state!==void 0&&state.editMode?/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:onDelete,children:\"L\\xF6schen\"}):null,/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:onSubmit,children:state!==null&&state!==void 0&&state.editMode?\"Speichern\":\"Buchen\"})]}):null]});};function HoursPicker(_ref){var state=_ref.state,setState=_ref.setState;return null;//TODO\nreturn/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"bookingDuration\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Stunden\"}),/*#__PURE__*/_jsxs(Form.Select,{children:[/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:\"1\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:\"2\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3\",children:\"3\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4\"})]})]});}function NoteField(_ref2){var _state$booking;var state=_ref2.state,setState=_ref2.setState;var onChange=function onChange(e){setState(_objectSpread(_objectSpread({},state),{},{booking:_objectSpread(_objectSpread({},state.booking),{},{note:e.target.value})}));};return/*#__PURE__*/_jsxs(Form.Group,{controlId:\"bookingNotes\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Notizen\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,className:\"bookingNotes\",value:state===null||state===void 0?void 0:(_state$booking=state.booking)===null||_state$booking===void 0?void 0:_state$booking.note,onChange:onChange,disabled:state===null||state===void 0?void 0:state.viewMode})]});}","map":{"version":3,"names":["React","useState","useEffect","useContext","Modal","Button","Form","HomePageContext","moment","timesMap","BookingsAPI","require","BookingModal","hpContext","setHpContext","state","setState","bookings","selected","booking","onCancel","onDelete","doAsync","del","id","reload","onSubmit","editMode","targetDateStart","weekday","add","weekSelection","offset","day","lesson","find","target","key","lessonHourStart","start","substring","lessonMinuteStart","set","targetDateEnd","book","roomSelection","toJSON","note","viewMode","HoursPicker","NoteField","onChange","e","value"],"sources":["/home/oliver/Desktop/awl-raumreservierung/frontend/src/pages/components/BookingModal.js"],"sourcesContent":["// Component imports\nimport React, {useState, useEffect, useContext} from 'react';\nimport { Modal, Button, Form } from 'react-bootstrap';\nimport {HomePageContext} from '../../contexts/HomePageContext';\nimport moment from 'moment';\n// Style imports\nimport '../../css/components/UserPage.css';\n// API imports\nimport timesMap from '../../api/timesMap.json';\nconst BookingsAPI = require('../../api/bookings');\n\nexport default function BookingModal(){\n    const {hpContext, setHpContext} = useContext(HomePageContext);\n    const [state, setState] = useState(null);\n\n    useEffect(() => {\n        if(hpContext.bookings.selected !== null){\n            setState(hpContext.bookings.selected);\n        }else{\n            setState(null);\n        }\n    }, [hpContext.bookings.selected]);\n\n    useEffect(() => {\n        if(state === null) return;\n        if(state.booking === null){\n            setState({...state, booking: {}});\n        }else{\n            // TODO: Edit/View Mode\n        }\n    }, [state]);\n\n    const onCancel = () => {\n        setHpContext({...hpContext, bookings: {...hpContext.bookings, selected: null}});\n    };\n\n    const onDelete = () => {\n        async function doAsync(){\n            await BookingsAPI.del(state.booking.id);\n\n            await setHpContext({...hpContext, bookings: {...hpContext.bookings, selected: null, reload: true}});\n        }\n        doAsync();\n    };\n    \n    const onSubmit = () => {\n        async function doAsync(){\n            if(!state.editMode){\n                var targetDateStart = moment().weekday(1).add(hpContext.weekSelection.offset, 'weeks').add(state.day - 1, 'days');\n                var lesson = timesMap.find(target => target.key === state.lesson);\n                var lessonHourStart = lesson.start.substring(0, 2);\n                var lessonMinuteStart = lesson.start.substring(3, 5);\n                targetDateStart.set('hour', lessonHourStart);\n                targetDateStart.set('minute', lessonMinuteStart);\n                targetDateStart.set('second', 0).set('millisecond', 0);\n                \n                var targetDateEnd = moment(targetDateStart).add(50, 'minutes');\n    \n                await BookingsAPI.book(hpContext.roomSelection.id, targetDateStart.toJSON(), targetDateEnd.toJSON(), state.booking.note);\n    \n                await setHpContext({...hpContext, bookings: {...hpContext.bookings, selected: null, reload: true}});\n            }else{\n                await setHpContext({...hpContext, bookings: {...hpContext.bookings, selected: null, reload: true}});\n            }\n        }\n        doAsync();\n    };\n\n    return(\n        <Modal show={state !== null} onHide={onCancel} centered>\n            <Modal.Header closeButton>\n                <Modal.Title>Buchung</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <Form>\n                    <HoursPicker state={state} setState={setState} />\n                    <NoteField state={state} setState={setState} />\n                </Form>\n            </Modal.Body>\n            {!state?.viewMode ?\n            <Modal.Footer>\n                <Button variant='ghost' onClick={onCancel}>Abbrechen</Button>\n                {state?.editMode ? <Button variant='danger' onClick={onDelete}>LÃ¶schen</Button> : null}\n                <Button variant='primary' onClick={onSubmit}>{state?.editMode ? \"Speichern\" : \"Buchen\"}</Button>\n            </Modal.Footer>\n            : null}\n        </Modal>\n    );\n};\n\nfunction HoursPicker({state, setState}){\n    return null; //TODO\n    return(\n        <Form.Group className=\"mb-3\" controlId=\"bookingDuration\">\n            <Form.Label>Stunden</Form.Label>\n            <Form.Select>\n                <option value=\"1\">1</option>\n                <option value=\"2\">2</option>\n                <option value=\"3\">3</option>\n                <option value=\"4\">4</option>\n            </Form.Select>\n        </Form.Group>\n    );\n}\n\nfunction NoteField({state, setState}){\n    const onChange = (e) => {\n        setState({...state, booking: {...state.booking, note: e.target.value}});\n    };\n\n    return(\n        <Form.Group controlId=\"bookingNotes\">\n            <Form.Label>Notizen</Form.Label>\n            <Form.Control as=\"textarea\" rows={3} className=\"bookingNotes\" value={state?.booking?.note} onChange={onChange} disabled={state?.viewMode} />\n        </Form.Group>\n    );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}