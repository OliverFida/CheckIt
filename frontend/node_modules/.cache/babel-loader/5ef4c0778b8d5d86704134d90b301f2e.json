{"ast":null,"code":"import _slicedToArray from\"/home/oliver/Desktop/awl-raumreservierung/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";// Component imports\nimport React,{useState,useEffect}from'react';import{Button,ButtonGroup,Stack,Table}from'react-bootstrap';import timesMap from'../../api/timesMap.json';import moment from'moment';// API imports\nimport BookingsAPI from'../../api/bookings';// Style imports\nimport'../../css/components/Stundenplan.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Stundenplan(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),tableHeadElements=_useState2[0],setTableHeadElements=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),bookings=_useState4[0],setBookings=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),tableBodyElements=_useState6[0],setTableBodyElements=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),weekOffset=_useState8[0],setWeekOffset=_useState8[1];useEffect(function(){generateTable();},[]);useEffect(function(){generateTable();},[weekOffset]);useEffect(function(){generateTableBody();},[bookings]);function generateTable(){generateTableHead();getBookings();}function getBookings(){setBookings(BookingsAPI.getBookings(null));}function generateTableHead(){console.log(\"Generate Head\");var dateToday=moment();dateToday.add(weekOffset,'weeks');var dateMonday=moment().weekday(1);var newTableHeadElements=[];newTableHeadElements.push(/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(Button,{disabled:weekOffset===0?true:false,onClick:onEarlier,children:\"Fr\\xFCher\"}),/*#__PURE__*/_jsx(Button,{disabled:weekOffset===3?true:false,onClick:onLater,children:\"Sp\\xE4ter\"})]})},\"th_0\"));for(var day=1;day<=5;day++){var tempDate=moment(dateMonday).add(day-1,'days');newTableHeadElements.push(/*#__PURE__*/_jsx(\"th\",{children:tempDate.format(\"DD.MM.YYYY\")},\"th_\".concat(day)));}console.log(\"Setting Head\");setTableHeadElements(newTableHeadElements);}function generateTableBody(){console.log(\"Generate Body\");var newTableBody=[];timesMap.forEach(function(lesson){newTableBody.push(generateRow(lesson));});setTableBodyElements(newTableBody);}function generateRow(lesson){var tempData=[];tempData.push(generateRowTitle(lesson));for(var day=1;day<=5;day++){if(lesson.key!==\"break\"){tempData.push(generateBooking(day,lesson));}else{tempData.push(/*#__PURE__*/_jsx(\"td\",{},\"break_\".concat(day)));}}var tempRow=/*#__PURE__*/_jsx(\"tr\",{children:tempData},lesson.key);return tempRow;}function generateRowTitle(lesson){var title;if(lesson.key===\"break\"){title=\"Pause\";}else{title=\"Stunde \".concat(lesson.key);}return/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"rowTitle\",children:[/*#__PURE__*/_jsx(\"span\",{children:/*#__PURE__*/_jsx(\"b\",{children:title})}),/*#__PURE__*/_jsxs(\"span\",{children:[lesson.start,\" - \",lesson.end]})]})},\"title\");}function generateBooking(day,lesson){var targetHour=lesson.start.substring(0,2);var targetMinute=lesson.start.substring(3,5);var targetDateFrom=moment().weekday(1).add(day-1,'days').set('hours',targetHour).set('minutes',targetMinute).set('seconds',0).set('milliseconds',0);var foundBooking=bookings.find(function(booking){return moment.utc(booking.startTime).isSame(targetDateFrom);});var timeOver;if(targetDateFrom.isBefore(moment()))timeOver=true;var disabled;if(foundBooking){var fremdGebucht=true;if(timeOver||fremdGebucht)disabled=true;return/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{variant:\"danger\",disabled:disabled,className:\"buchenBtn\",children:/*#__PURE__*/_jsx(\"span\",{children:\"Gebucht\"})})},\"booking_\".concat(day,\"_\").concat(lesson.key));}if(timeOver)disabled=true;return/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{variant:\"light\",disabled:disabled,className:\"buchenBtn\",children:\"Buchen\"})},\"booking_\".concat(day,\"_\").concat(lesson.key));}var onEarlier=function onEarlier(){setWeekOffset(weekOffset-1);};var onLater=function onLater(){setWeekOffset(weekOffset+1);};return/*#__PURE__*/_jsx(Stack,{direction:\"vertical\",children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsx(\"tr\",{children:tableHeadElements})}),/*#__PURE__*/_jsx(\"tbody\",{children:tableBodyElements})]})});};","map":{"version":3,"names":["React","useState","useEffect","Button","ButtonGroup","Stack","Table","timesMap","moment","BookingsAPI","Stundenplan","tableHeadElements","setTableHeadElements","bookings","setBookings","tableBodyElements","setTableBodyElements","weekOffset","setWeekOffset","generateTable","generateTableBody","generateTableHead","getBookings","console","log","dateToday","add","dateMonday","weekday","newTableHeadElements","push","onEarlier","onLater","day","tempDate","format","newTableBody","forEach","lesson","generateRow","tempData","generateRowTitle","key","generateBooking","tempRow","title","start","end","targetHour","substring","targetMinute","targetDateFrom","set","foundBooking","find","booking","utc","startTime","isSame","timeOver","isBefore","disabled","fremdGebucht"],"sources":["/home/oliver/Desktop/awl-raumreservierung/frontend/src/pages/components/Stundenplan.js"],"sourcesContent":["// Component imports\nimport React, {useState, useEffect} from 'react';\nimport {Button, ButtonGroup, Stack, Table} from 'react-bootstrap';\nimport timesMap from '../../api/timesMap.json';\nimport moment from 'moment';\n// API imports\nimport BookingsAPI from '../../api/bookings';\n// Style imports\nimport '../../css/components/Stundenplan.css';\n\nexport default function Stundenplan(){\n    const [tableHeadElements, setTableHeadElements] = useState([]);\n    const [bookings, setBookings] = useState([]);\n    const [tableBodyElements, setTableBodyElements] = useState([]);\n    const [weekOffset, setWeekOffset] = useState(0);\n    \n    useEffect(() => {\n        generateTable();\n    }, []);\n\n    useEffect(() => {\n        generateTable();\n    }, [weekOffset]);\n\n    useEffect(() => {\n        generateTableBody();\n    }, [bookings]);\n\n    function generateTable(){\n        generateTableHead();\n        getBookings();\n    }\n\n    function getBookings(){\n        setBookings(BookingsAPI.getBookings(null));\n    }\n\n    function generateTableHead(){\n        console.log(\"Generate Head\");\n        var dateToday = moment();\n        dateToday.add(weekOffset, 'weeks');\n\n        var dateMonday = moment().weekday(1);\n\n        var newTableHeadElements = [];\n        newTableHeadElements.push(<th key=\"th_0\">\n            <ButtonGroup>\n                <Button disabled={weekOffset === 0 ? true : false} onClick={onEarlier}>Früher</Button>\n                <Button disabled={weekOffset === 3 ? true : false} onClick={onLater}>Später</Button>\n            </ButtonGroup>\n        </th>);\n        for(var day = 1; day <= 5; day++){\n            var tempDate = moment(dateMonday).add(day - 1, 'days');\n            newTableHeadElements.push(<th key={`th_${day}`}>{tempDate.format(\"DD.MM.YYYY\")}</th>);\n        }\n\n        console.log(\"Setting Head\");\n        setTableHeadElements(newTableHeadElements);\n    }\n\n    function generateTableBody(){\n        console.log(\"Generate Body\");\n        var newTableBody = [];\n\n        timesMap.forEach(lesson => {\n            newTableBody.push(generateRow(lesson));\n        });\n\n        setTableBodyElements(newTableBody);\n    }\n\n    function generateRow(lesson){\n        var tempData = [];\n\n        tempData.push(generateRowTitle(lesson));\n\n        for(var day = 1; day <= 5; day++){\n            if(lesson.key !== \"break\"){\n                tempData.push(generateBooking(day, lesson));\n            }else{\n                tempData.push(<td key={`break_${day}`}></td>);\n            }\n        }\n\n        var tempRow = <tr key={lesson.key}>{tempData}</tr>;\n\n        return tempRow;\n    }\n\n    function generateRowTitle(lesson){\n        var title;\n\n        if(lesson.key === \"break\"){\n            title = \"Pause\";\n        }else{\n            title = `Stunde ${lesson.key}`;\n        }\n\n        return <td key=\"title\"><div className=\"rowTitle\"><span><b>{title}</b></span><span>{lesson.start} - {lesson.end}</span></div></td>;\n    }\n\n    function generateBooking(day, lesson){\n        var targetHour = lesson.start.substring(0, 2);\n        var targetMinute = lesson.start.substring(3, 5);\n\n        var targetDateFrom = moment().weekday(1).add((day - 1), 'days').set('hours', targetHour).set('minutes', targetMinute).set('seconds', 0).set('milliseconds', 0);\n\n        var foundBooking = bookings.find(booking => moment.utc(booking.startTime).isSame(targetDateFrom));\n        \n        var timeOver;\n        if(targetDateFrom.isBefore(moment())) timeOver = true;\n        var disabled;\n\n        if(foundBooking){\n            var fremdGebucht = true;\n            if(timeOver || fremdGebucht) disabled = true;\n            return <td key={`booking_${day}_${lesson.key}`}><Button variant='danger' disabled={disabled} className=\"buchenBtn\"><span>Gebucht</span></Button></td>;\n        }\n        if(timeOver) disabled = true;\n        return <td key={`booking_${day}_${lesson.key}`}><Button variant='light' disabled={disabled} className=\"buchenBtn\">Buchen</Button></td>;\n    }\n\n    const onEarlier = () => {\n        setWeekOffset(weekOffset - 1);\n    }\n\n    const onLater = () => {\n        setWeekOffset(weekOffset + 1);\n    }\n\n    return(\n        <Stack direction='vertical'>\n            <Table>\n                <thead>\n                    <tr>\n                        {tableHeadElements}\n                    </tr>\n                </thead>\n                <tbody>\n                    {tableBodyElements}\n                </tbody>\n            </Table>\n        </Stack>\n    );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}